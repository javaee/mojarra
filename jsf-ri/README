This README documents the Sun Reference implementation (RI) for JSR 127,
JavaServer (tm) Faces.

jsf-api cvs tag for this implementation: JSF_API_20031009
jsf-api-spec for this implementation: JSF_20030930.pdf

Installation Notes
==================

JavaServer (tm) Faces is intended to run in a Servlet 2.3, JSP 1.2 web
container, such as that distributed with Java Web Services Developer
Pack <http://java.sun.com/webservices/webservicespack.html>.  Please
follow the instructions for your container and have it working well in
your environment before continuing with these installation notes.

To use JavaServer (tm) Faces in your own webapp, you need to follow the
online documentation at <http://java.sun.com/j2ee/javaserverfaces/>.
Make sure to include all the jars in the lib directory of this
distribution in your WEB-INF/lib directory in your webapp.  

Major changes/features in this release:
=======================================

SECTION: API Changes by scarab issue, since JSF_API_20030930 draft

JSFA3 Naming Container

  M src/javax/faces/webapp/UIComponentTag.java
    use request scope to store the componentIDs HashMap instead
    of page scope since we get a new PageContext in the case of
    imported and included pages.
  A src/javax/faces/component/UINamingContainer.java
    NamingContainer implementation.

  M src/javax/faces/application/StateManager.java
  M src/javax/faces/application/ViewHandler.java

    Move the responsibility for enforcing the id uniqueness property back
    to StateManager.saveSerializedView(), as Adam suggested.

  M src/javax/faces/webapp/UIComponentTag    
   - UIComponentTag will now store a list in the PageContext      
     of all user defined component ID.  If any duplicates      
     are found throw an IllegalStateException wrapped by a       
     JSPException.      
   - Updated pending remark in doStartTag().  The FacesContext      
     will be checked for in the PageContext first, if not found,      
     then call FacesContext.getCurrentInstance().   
     Once obtained store in PageContext to refrain from repeated calls to       
     getCurrentInstance().

     Spec bug.  UIForm must still implement NamingContainer.  This was
     removed accidentally when applying Adam's proposal to the code.

     Removed unused instance variable.

JSFA101

  - Add mapping of component type "NamingContainer" to UINamingContainer.

  M tools/javax/faces/generate/GenerateConcreteClasses.java

  - generate an implementation of the {save,restore}State() methods on
    StateHolder.

  RI Impact: 

  These changes will need to be pulled into the jsf-ri-config.xml

  When we generate the jsf-ri-config.xml, these changes will automatically
  get pulled in.

  Change the html taglib to use these new component types that map to
  concrete HTML components.

  M doc/standard-html-renderkit.xml

  - add missing component for TextRenderer HtmlOutputText

  - add component-type entries for the concrete HTML Components.

  - remove "base" where it occurrs.

  - Add component-type elements for all <renderers>

  - Normalize all occurrences of "TextArea" to be "Textarea".

  - Assign default values to primitive types.

    Boolean == false

    Number types == <number>.MIN_VALUE.


JSFA126 attached objects.

   M src/javax/faces/component/UIComponentBase.java

   - find component fix, from Ryan Lubke.

     Make sure to look if the match requested *is* a naming container.

   - new public static methods 

       /**
	*
	* <p>This method is called by {@link UIComponent} subclasses that
	* want to save one or more attached objects.  It is a convenience
	* method that does the work of saving attached objects that may or
	* may not implement the {@link StateHolder} interface.  Using this
	* method implies the use of {@link #restoreAttachedState} to restore
	* the attached objects.</p>
	*
	* <p>This method supports saving attached objects of the following
	* type: <code>Object</code>, <code>List</code> of
	* <code>Object</code> and array of <code>List</code> of
	* <code>Object</code>.</p>
	*
	* <p>Algorithm:</p>
	*
	* <ul>
	*
	* <p>If argument <code>attachedObject</code> is <code>null</code>
	* return.</p>
	*
	* <p>If the argument <code>attachedObject</code> is an array of
	* <code>List</code> call a private helper method to handle this
	* case.  Return the result.</p>
	*
	* <p>If the argument <code>attachedObject</code> is itself a
	* <code>List</code>, create a new <code>List</code> and fill it
	* with one <code>StateHolderSaver</code> for each element in the
	* argument <code>attachedObject</code> list.  Return the new
	* <code>List</code>.</p>
	*
	* <p>Otherwise, create a <code>StateHolderSaver</code> instance
	* around the argument <code>attachedObject</code> and return
	* it.</p>
	*
	* </ul>
	*
	* @param context the {@link FacesContext} for this request.
	*
	* @param attachedObject the object, which may be an array of
	* <code>List</code> instances, a <code>List</code> instance, or an
	* Object.  The <code>attachedObject</code> (or the elements that
	* comprise <code>attachedObject</code> may implement {@link
	* StateHolder}.
	*
	* @exception NullPointerException if the context argument is null.
	*
	*/

       public static Object saveAttachedState(FacesContext context,
					      Object attachedObject) {}

       /**
	*
	* <p>This method is called by {@link UIComponent} subclasses that
	* need to restore the objects they saved using {@link
	* #saveAttachedState}.  This method is tightly coupled with {@link
	* #saveAttachedState}.</p>
	*
	* <p>This method supports restoring all attached objects types
	* supported by {@link #saveAttachedState}.</p>
	*
	* <p>Algorithm:</p>
	*
	* <p>If the argument <code>stateObj</code> is an array of
	* <code>Object</code> instances, call a private helper method and
	* return the result.</p>
	*
	* <p>If the argument <code>stateObj</code> is a <code>List</code>,
	* create a new <code>List</code> to hold the result.  Treat each
	* element of <code>stateObj</code> as a
	* <code>StateHolderSaver</code> instance and call
	* <code>restore</code> on it, saving the result to the result
	* <code>List</code>, which is returned.</p>
	*
	* <p>If the argument <code>stateObj</code> is an instance of
	* <code>StateHolderSaver</code> call <code>restore</code> on it and
	* return the result.</p>
	*
	* @param context the {@link FacesContext} for this request
	*
	* @param stateObj the opaque object returned from {@link
	* #saveAttachedState}
	*
	* @exception NullPointerException if context is null.
	*
	* @exception IllegalStateException if we don't have a
	* <code>StateHolderSaver</code> instance where we expect one.
	*
	*/

       public static Object restoreAttachedState(FacesContext context,
						 Object stateObj) throws IllegalStateException {}

   RI and DEMO Impact: any component that has attached objects to save will
   have to call UIComponentBase.{save,restore}AttachedState().  

   A src/javax/faces/component/StateHolderSaver.java

   - new home for StateHolderSaver.

   R src/javax/faces/application/StateHolderSaver.java

   - this shouldn't be in the application package.

   M src/javax/faces/application/StateManager.java

   - remove attached object methods from here

   M src/javax/faces/component/UICommand.java
   M src/javax/faces/component/UIData.java
   M src/javax/faces/component/UIGraphic.java
   M src/javax/faces/component/UIInput.java
   M src/javax/faces/component/UIOutput.java
   M src/javax/faces/component/UIPanel.java
   M src/javax/faces/component/UIParameter.java
   M src/javax/faces/component/UISelectItem.java
   M src/javax/faces/component/UISelectItems.java
   M src/javax/faces/component/ValueHolderSupport.java

   - leverage the new attached object APIs

   - Added clarification to ViewHandler.renderView() and
     ViewHandler.getViewIdPath() to consider the output of
     HttpServletRequest.getServletPath() in congunction with the one or
     more url-pattern mappings obtained from the deployment descriptor
     to determine which mapping was used to invoke the FacesServlet.

   Scarab issue: JSFA110 JSFA42

     Clarified ViewHandler.renderView() and ViewHandler.getViewIdPath()
     to reflect the possibility of multiple url-pattern mappings for the
     FacesServlet.

     Modified ConfigParser to qualify digester with 'this'


     Fold in Hans's spec changes.

     RI Impact: see below

     M src/javax/faces/application/ViewHandler.java

     - change the contrat of getViewIdPath to take action in both prefix and
       suffix cases.

     - change the contract of renderView to replace the existing suffix with
       the new one in the case of extension mapping.

Bugfixes

  M src/javax/faces/convert/DateTimeConverter.java

  - Since GregorianCalendar requires a default TimeZone, we shouldn't be
    wiping it out if possible.

TCK related changes

  M src/javax/faces/convert/DateTimeConverter.java    
   - Javadoc clarifications to the following for returns      
     of getters.    
   - renamed {get,set}ParseLocale to {get,set}Locale    
   - If timezone has not been set, but getTimeZone() is      
     called, return the default TimeZone of the VM    
   - If locale has not been set, but getLocale() is      
     called, return the locale (and possibly default      
     locale of VM) from FacesContext    
   - Removed empty string check when testing patterns      
      this should be passed through.    
   - Ensure locales are set on all of the DateFormat       
     instances.    
   - Updated private method getLocale() to only leverage      
     FacesContext to obtain Locale info.  Javadocs state      
     that if no locale is available to the FacesContext      
     the default VM locale will be used.

SECTION: Spec document changes:

  [JSFA92][JSFA116]

  [9.5.7]

    Assert that the <f:subview> tag must not contain an <f:view> tag.

  [JSFA3]

   7.6.1

     Move the responsibility for enforcing the id uniqueness property back
     to StateManager.saveSerializedView(), as Adam suggested.


  [JSFA120] Implement spec changes related to event bubbling changes.

    * [2.2.2 ... 2.2.5] -- Refine the lifecycle phase descriptions to document
      that event broadcasting is performed by the processXxx method of
      the UIViewRoot instance at the root of the component tree.

    * [2.3] -- Refine overall description of the Common Event Processing
      to match the new behavior factoring.

    * [3.1.10] -- Document the new UIComponent.queueEvent() method.

    * [6.1.6] -- Remove FacesContext.addFacesEvent() and
      getFacesEvents().

    * Further [JSFA120] related commit (document updated behavior of
      UIViewRoot) plus some cosmetic changes.  Impact analysis for all
      of [JSFA120] was in the previous spec commit message.

    * [JSFA120] Ensure that an ANY_PHASE listener sees any single event
      once, instead of once per phase in the case where there are
      listeners registered for later phases explicitly.

    * [JSFA120] Correct implementation of event queueing so that we
      won't see ConcurrentModificationException errors if new events are
      queued while the existing ones are being processed.  Essentially,
      this required simulating an Iterator.

    RI IMPACTS:

    * Any renderer whose decode method needs to queue events must call the
      queueEvent() method on the source UIComponent, instead of calling
      the removed FacesContext.addFacesEvent() method.

    * FacesContextImpl - remove event queue functionality.

    * LifecycleImpl - remove event broadcasting functionality, which is now
      handled by UIViewRoot.  Add call to
      UIViewRoot.processApplication() during Invoke Application phase.

   JSFA3, JSFA101, JSFA110, JSFA76

   3.1.1 

     New rules for component id validitiy

   3.2.2 

     Emasculate this section, since NamingContainer has no more PME.

   3.1.6

     New description of find component

   4.1.4.{2,3,4}, 4.1.15.{2,3,4}

     No methods on NamingContainer

   6.1.2

     Remove ExternalContext.encodeURL().

   10.3.3.

     Import current DTD.

   8.6

     New section documenting the concrete HTML component classes.

   JSFA76/JSFA104

   4.1.4.

     Fix assertion to say that the form Renderer must call writeState.

   4.1.4.3

     Document new methods:

     public boolean isSubmitted();

     public void setSubmitted(boolean submitted);

     public void processDecodes(FacesContext context) throws IOException;

     public void processValidators(FacesContext context);

     public void processUpdates(FacesContext context);

   8.5.3 

     Document the new requirements on FormRenderer.

   4.1.4.3 

     Spec assertion to cause the UIForm to call setSubmitted(false) from
     its saveState().

   JSFA121

     SECTION 11.1.  Note that you can add cause a PhaseListener to be added
     by making an entry in the faces-config.xml file.

     RI Impact:

     Need to modify digester rules such that the <phase-listener> element 
     causes Lifecycle.addPhaseListener() to be called.

   JSFA119

     RI IMPACT: Make sure that the RI never ever uses the presence of
     messages in the FacesContext as a cue for skipping to render response.

     2.2.3

       Removed text that talks about using the presence of Messages as a cue
       for skipping to Render Response Phase.

     RI Impact: I think this will break some of our lifecycle tests.
     Also, I think we're going to want to change the exception we catch
     in UpdateModelValuesPhase to be RuntimeException.

     sections 2.2.3, 2.2.4, 3.1.11

     - Spec that if a RuntimeException is thrown during decode, validation,
       or update model processing, it is caught, renderResponse() is
       called, and the exception is re-thrown.



SECTION: RI Changes: 150 commit messages

Known Issues With This Release
==============================

* cardemo checkboxes do not properly set themselves when choosing a
  package.

* cardemo dynamic pricing is broken, the prices always go up!

* Some renderer (and therefore tag) attributes have the incorrect type
  with respect to the HTML 4.01 spec.

Legal Notice
============

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle, Santa
Clara, California 95054, U.S.A. All rights reserved.

Sun Microsystems, Inc. has intellectual property rights relating to
technology embodied in this product. In particular, and without
limitation, these intellectual property rights may include one or more
of the U.S. patents listed at http://www.sun.com/patents and one or more
additional patents or pending patent applications in the U.S. and other
countries.

This product is distributed under licenses restricting its use, copying
distribution, and decompilation. No part of this product may be
reproduced in any form by any means without prior written authorization
of Sun and its licensors, if any.

Third-party software, including font technology, is copyrighted and
licensed from Sun suppliers.

Sun, Sun Microsystems, the Sun logo, the Java Coffee Cup logo,
JavaServer, and Java are trademarks or registered trademarks of Sun
Microsystems, Inc. in the U.S. and other countries.

Federal Acquisitions: Commercial Software - Government Users Subject to
Standard License Terms and Conditions.

-----------------------------------------------------------------------

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle,
Santa Clara, California 95054, Etats-Unis. Tous droits réservés.

Sun Microsystems, Inc. a les droits de propriété intellectuels relatants
à la technologie incorporée dans ce produit. En particulier, et sans la
limitation, ces droits de propriété intellectuels peuvent inclure un ou
plus des brevets américains énumérés à http://www.sun.com/patents et un
ou les brevets plus supplémentaires ou les applications de brevet en
attente dans les Etats - Unis et les autres pays.

Ce produit ou document est protégé par un copyright et distribué avec
des licences qui en restreignent l'utilisation, la copie, la
distribution, et la décompilation. Aucune partie de ce produit ou
document ne peut être reproduite sous aucune forme, par quelque moyen
que ce soit, sans l'autorisation préalable et écrite de Sun et de ses
bailleurs de licence, s'il y ena.

Le logiciel détenu par des tiers, et qui comprend la technologie
relative aux polices de caractères, est protégé par un copyright et
licencié par des fournisseurs de Sun.

Sun, Sun Microsystems, le logo Sun, le logo Java Coffee Cup, JavaServer,
et Java sont des marques de fabrique ou des marques déposées de Sun
Microsystems, Inc. aux Etats-Unis et dans d'autres pays.
