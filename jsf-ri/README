This README documents the Sun Reference implementation (RI) for JSR 127,
JavaServer (tm) Faces.

jsf-api cvs tag for this implementation: JSF_API_20030912A
jsf-api-spec for this implementation: JSF_20030912.pdf

Installation Notes
==================

JavaServer (tm) Faces is intended to run in a Servlet 2.3, JSP 1.2 web
container, such as that distributed with Java Web Services Developer
Pack <http://java.sun.com/webservices/webservicespack.html>.  Please
follow the instructions for your container and have it working well in
your environment before continuing with these installation notes.

To use JavaServer (tm) Faces in your own webapp, you need to follow the
online documentation at <http://java.sun.com/j2ee/javaserverfaces/>.
Make sure to include all the jars in the lib directory of this
distribution in your WEB-INF/lib directory in your webapp.  

Major changes/features in this release:
=======================================

SECTION: API Changes

  Issues:

    JSFA29 DataGrid

    JSFA118 FactoryFinder

    JSFA92 Jsp Processing

    JSFA22 State Saving

  Code changes: 72 messages

    web-facesconfig_1_0.dtd

    - I forgot to add the ELEMENT definitions for the factory elements

    - Clarify the DTD such that <summary> and <detail> elements with no
      "xml:lang" should be associated with the language associated wth
      the default Locale for the underlying JVM.

    - Clarify MessageResources() such that, when localized text for a
      particular Locale is not available, it can return the text
      associated with the language specified by the default Locale
      (i.e. by the text that was configured with no xml:lang
      attributes).

    FactoryFinder.java

    - comment typo

    - guard against null implementations List.

    FacesContext.java:  

    - Refine responsibilities of setViewRoot() to include clearing any
      queued events and messages.  This needs to be ported to the HEAD
      branch unconditionally, no matter what happens with DataGrid.

    UIData.java

    - Refine responsibilities of setRowIndex() to also expose
      the corresponding data object via the "var" property, if present.

    RepeaterSupport.java 

    - Ensure that the default "valid" property for Repeater-child
      components is "true", which is the same as for non-Repeater
      children.

    - Change SEPARATOR for repeaters from ':' to '_'

    UICommandBase.java UIGraphicBase.java UIInputBase.java 
      UIOutputBase.java UIPanelBase.java UIParameterBase.java 
      UISelectItemBase.java UISelectItemsBase.java 

    - When we are nested in a Repeater whose rowIndex is currently zero,
      store "previous", "valid", and "value" properties locally instead of
      in the Repeater.

    RepeaterMessage.java 

    - Add a wrapper for messages enqueued for a component that is nested
      in a Repeater.

    ExternalContext.java 

    - Add four security-related methods (getAuthType, getRemoteUser,
      getUserPrincipal, and isUserInRole) to ExternalContext so that
      applications can check these things independent of the Servlet and
      Portlet APIs.

    RenderKit.java 

    - Remove IAE when addRenderer() is called with the same rendererType.

    UIComponent.java 

    - Change SEPARATOR_CHAR for components from '_' to ':'

    AttributeTag.java, ConverterTag.java, UIComponentTag.java
      ValidatorTag.java

    - Expose a stack of the currently nested UIComponentTag instances as a
      request scope attribue, so that pages included via <c:import> or
      <jsp:include> can be assembled into a single component tree.  Add
      new public static method getParentUIComponentTag(PageContext) so that
      other comnponent tags can use it instead of walking getParent().


    UIComponentTagTestCase.java

    - In reset(), remove the request scope attribute in case a previous
      run left it there accidentally.

    TestUtil.java, UICommandBaseTestCase.java UIComponentBaseTestCase.java 
	UIInputBaseTestCase.java UIOutputBaseTestCase.java 
	UIParameterBaseTestCase.java UISelectItemBaseTestCase.java 
	UIViewRootBaseTestCase.java ValueHolderTestCaseBase.java 

    - Fix faulty logic in string comparisons.

    UISelectMany.java 

    - Spec javadoc changes for UISelectMany.

    StateManager.java ViewHandler.java UIComponentBase.java
      ResponseStateManager.java MockViewHandler.java StateHolder.java
      UIComponent.java UIData.java UICommandBase.java
      UIComponentBase.java UIGraphicBase.java
      UIInputBase.java UIOutputBase.java UIPanelBase.java 
      UIParameterBase.java UISelectItemBase.java 
      UISelectItemsBase.java UIViewRootBase.java 
      DateTimeConverter.java NumberConverter.java 
      DoubleRangeValidator.java LengthValidator.java 
      LongRangeValidator.java StringRangeValidator.java 
      UIColumnTestCase.java UIDataTestCase.java 
      TestActionListener.java TestValidator.java 
      TestValueChangedListener.java UICommandBaseTestCase.java 
      UIComponentBaseStateTestCase.java UIComponentBaseTestCase.java 
      UIGraphicBaseTestCase.java UIInputBaseTestCase.java 
      UIOutputBaseTestCase.java UIPanelBaseTestCase.java 
      UIParameterBaseTestCase.java UISelectItemBaseTestCase.java 
      UISelectItemsBaseTestCase.java UIViewRootBaseTestCase.java 
      ValueHolderTestCaseBase.java 
      MockViewHandler.java 

    - Implement the state saving changes proposed by Adam Winer in
      <http://archives.java.sun.com/cgi-bin/wa?A2=ind0309&L=jsr-127-eg&F=&S=&X=23B32C05625A57F670&Y=ed.burns@sun.com&P=6085>.
      This change only impacts the state saving case.  The restore case
      is the same.

    - Implement state saving name changes proposed by Adam Winer in
      <http://archives.java.sun.com/cgi-bin/wa?A2=ind0309&L=jsr-127-eg&F=&S=&X=23B32C05625A57F670&Y=ed.burns@sun.com&P=6218>.

    StateManager.java ViewHandler.java 

    - Implement state saving changes proposed by Adam winer in
      <http://archives.java.sun.com/cgi-bin/wa?A2=ind0309&L=jsr-127-eg&F=&S=&X=23B32C05625A57F670&Y=ed.burns@sun.com&P=11103>

    StateHolderSaver.java 

    - made this class public, pending moving to UIComponent package, when it
      can be made private again.

    - null out the className if an attached object is marked transient.
   
    UIComponentBase.java

    - Make UIComponent.validateId() disallow the use of
      UIComponent.SEPARATOR_CHAR in ids, per Adam's suggestion on
      20030911.

    - Special case code for handling facets and state management.  Since
      facets are stored in a HashMap, there is no ordering.  There needs to
      be ordering for state management to work correctly.  Thus, flatten out
      the facet HashMap into name/value pairs, stored in an array.

    MockViewHandler.java

    - Fix compilation error I introduced.
    
    StateManager.java UIData.java UICommandBase.java
      UIComponentBase.java UIGraphicBase.java UIInputBase.java
      UIOutputBase.java UIPanelBase.java UIParameterBase.java
      UISelectItemBase.java UISelectItemsBase.java

    - restoreAttachedObject now merges any attached objects that were
      registered during component creation time except for converter,
      repeater that get overwritten.

SECTION: Spec document changes:

    DataGrid changes.

    State that by-type Converter registration must occurr for the Class
    instances that correspond to the java language primitive types, as 
    given in <WRAPPER>.TYPE, where <WRAPPER> is one of the java.lang wrapper
    classes for the primitive types.

    Modify RestoreView to require that implementetations skip to
    renderResponse(), after restoring the view, if there is no POST
    data or query parameters.

    2.1.1 

      We now require the caller to set the new view into the FacesContext.

    2.2.1

      It is the restore view phase's responsibility to set the viewRoot into
      the FacesContext.

    3.1.11 

      Change getState to saveState.

    3.2.1.3

      Change getState to saveState.

    3.2.4.2

      Change getState to saveState.

    4.1.4

      UIForm calls ViewHandler.writeState.

    7.1.1

      the default ActionListener has to call context.renderResponse() so that
      the Process Validations through Invoke Application phases are
      skipped when UICommand has immediate="true".

    7.5 

      ViewHandler.restoreView() returns UIViewRoot; is not responsible for
      setting it into the FacesContext.

    7.6.1 

      Remove StateManager.writeStateMarker.

    8.3 

      Remove ResponseStateManager.writeStateMarker.

    remove commandName from JSP example.

SECTION: RI Changes: 150 commit messages

  FacesContextImpl.java 

  - Implement wrapping a FacesEvent inside a RepeaterEvent if appropriate.

	tabbedpanes.jsp 

  Changed the command attribute "label" to "value". Added "converter"
      attribute to commands.


  Modify tabbed panes demo to use <jsp:include> instead of <% include %>
  to prove that it works.

  
	AreaRenderer.java MenuBarRenderer.java ResultSetControls.java 

Log Message:
Revise the generated JavaScript to put the DOM object name in square
brackets and quotes.  This allows us to utilize arbitrarily complex
client identifiers and things will still work.

M components/web/menu.jsp

- Altered markup to allow automated testing.

M test/tests/com/sun/faces/demotest/components/TestComponents.java

- Added test to exercise menu.jsp

	TestComponents.java 
Log Message:
Start work on automation of result-set.jsp.

	build.xml 
Log Message:
At Ana von Klopp's request, include TLDDoc in dist bundle.

	XulViewHandlerImpl.java 
	UserNumberBean.java 
	AreaComponent.java MapComponent.java 
	CustomerBean.java FormatValidator.java 
Log Message:
r=visvan

Implement Adam's name change suggestions from
<http://wspack.sfbay.sun.com/jsf/eg-archive/2509.html>.

	XulViewHandlerImpl.java 
Added Files:
	BuildComponentFromTag.java BuildComponentFromTagImpl.java 
	XmlDialectProvider.java XmlXulRuleSet.java 
	XulDialectProvider.java 
	RIConstants.java 
Log Message:
[r=edburns]

Added navigation support to nonjsp demo.

	BuildComponentFromTagImpl.java 
Log Message:
[r=craigmcc]

Changed the command attribute "label" to "value". Added "converter" attribute to commands. 

	helloDuke.xul 
Log Message:
[r=craigmcc]

Changed the command attribute "label" to "value". Added "converter" attribute to commands. 

	greeting.jsp response.jsp 
Log Message:
[r=craigmcc]

Changed the command attribute "label" to "value". Added "converter" attribute to commands. 

	command_button_row.jsp command_hyperlink_row.jsp 
	panel_grid_row.jsp 
Log Message:
[r=craigmcc]

Changed the command attribute "label" to "value". Added "converter" attribute to commands. 

	command_button_row.jsp command_hyperlink_row.jsp 
	Resources.properties Resources_en_US.properties 
Log Message:
[r=edburns]

Port Craig's fix to the RI head.

The <a> element for a hyperlnk has to be rendered in encodeBegin() rather than encodeEnd(), so that any nested content becomes the hyperlink label.

Fixed hyperlink portion of standard demo so that image is displayed properly.

jsf-demo:

M standard/src/standard/Resources.properties
M standard/src/standard/Resources_en_US.properties
M standard/web/command_button_row.jsp
M standard/web/command_hyperlink_row.jsp

M cardemo/src/cardemo/FormatValidator.java
    Now implements StateHolder.

M cardemo/web/ImageMap.jsp
M cardemo/web/outofstock.jsp
   Remove "-" from ids.

M cardemo/web/WEB-INF/web.xml
    change state saving method to "client"

M components/src/components/renderkit/MapRenderer.java
    do not render "form". make use to <h:form>. 

M components/src/components/components/AreaComponent.java
  save targetImage attribute as part of the state.

M components/src/components/components/GraphComponent.java
  make GraphListener implement StateHolder and mark it as transient. Because the
  listener is registered in the constructor, it doesn't have to be persisted.

M components/src/components/components/PaneComponent.java
  make PaneSelectedListener implement StateHolder and mark it as transient. Because the
  listener is registered in the constructor, it doesn't have to be persisted.
  Removed Pending comments.

M components/src/components/renderkit/ResultSetControls.java
  make the class public and add a no-arg constructor so that it can be
  instantiated via Reflection.

M components/src/components/renderkit/TabLabelRenderer.java
  Removed Pending comments.

M components/src/components/taglib/ResultSetTag.java
  extend UIComponentTag instead of UIComponentBodyTag.

	TestComponents.java 
Log Message:
use ":" as the seperator char;  For example "JSPid1:menu2"
    
	html_basic.tld 
Log Message:
[JSFA29] Merge TableRenderer (for DataGrid) and associated tags and
behavior changes in FacesContextImpl from JSF_RI_DATAGRID_BRANCH.

	jsf-ri-config.xml 
Log Message:
[JSFA29] Merge TableRenderer (for DataGrid) and associated tags and
behavior changes in FacesContextImpl from JSF_RI_DATAGRID_BRANCH.

	FacesContextImpl.java 
Log Message:
[JSFA29] Merge TableRenderer (for DataGrid) and associated tags and
behavior changes in FacesContextImpl from JSF_RI_DATAGRID_BRANCH.

	TableRenderer.java 
Log Message:
[JSFA29] Merge TableRenderer (for DataGrid) and associated tags and
behavior changes in FacesContextImpl from JSF_RI_DATAGRID_BRANCH.

	ColumnTag.java DataTableTag.java 
Log Message:
[JSFA29] Merge TableRenderer (for DataGrid) and associated tags and
behavior changes in FacesContextImpl from JSF_RI_DATAGRID_BRANCH.

M src/com/sun/faces/taglib/jsf_core/ActionListenerTag.java
M src/com/sun/faces/taglib/jsf_core/ValueChangedListenerTag.java

  Use the new static method to find the parent UIComponentTag
  (related to allowing included pages to have components).

M test/com/sun/faces/lifecycle/TestRenderResponsePhase.java
M web/test/RenderResponse_correct
M web/test/TestLifecycleImpl_initial_correct
M web/test/TestViewHandlerImpl_correct

  Update golden files to reflect change in separator character.


M systest/src/com/sun/faces/jsptst/JstlIntegrationTestCase.java
A systest/web/jsp/jstl-import-00.jsp
A systest/web/jsp/jstl-import-01.jsp
A systest/web/jsp/jstl-import-01a.jsp
A systest/web/jsp/jstl-import-01b.jsp
A systest/web/jsp/jstl-import-02.jsp
A systest/web/jsp/jstl-import-02a.jsp
A systest/web/jsp/jstl-import-02b.jsp

  Initial systests for including pages via <c:import>.

	JstlIntegrationTestCase.java 
Log Message:
Add test scenarios that conditionally include subpages.  At present,
you have to have explicit component ids on components in the subpages
(just as if you had included them with <%@ include %> instead).

	ExternalContextImpl.java 
Log Message:
Provide callthrough methods for getAuthType(), getRemoteUser(), getUserPrincipal(),
and isUserInRole().

M src/com/sun/faces/config/ConfigParser.java

- Make sure to have by-class registration on <WRAPPER>.TYPE Class
  instances, where <WRAPPER> is one of: Boolean, Byte, Character, Short,
  Integer, Float, Long, or Double.  This is necessary to support
  UISelectMany having model types "array of primitive".

M src/com/sun/faces/renderkit/html_basic/HtmlBasicRenderer.java

- moved some methods to Util.

M src/com/sun/faces/renderkit/html_basic/MenuRenderer.java

- Logic changes for UISelectMany.  See UISelectMany javadoc.

M src/com/sun/faces/util/Util.java

- take methods from HtmlBasicRenderer.

- remove unused defaultConverter stuff.

M test/com/sun/faces/convert/TestConverters.java

- test of this feature.

M test/com/sun/faces/util/TestUtil_local.java

- removed testDefaultConverters stuff.

	html_basic.tld jsf_core.tld 
Log Message:
Change the short names to be more TLDDoc friendly.

M src/com/sun/faces/renderkit/html_basic/HyperlinkRenderer.java

- Place [' and '] around our clientId.

M test/com/sun/faces/lifecycle/TestRenderResponsePhase.java
M test/com/sun/faces/renderkit/html_basic/TestRenderers_1.java
M web/test/CorrectRenderersResponse
M web/test/RenderResponse_correct

- accomodate the tests.

M src/com/sun/faces/application/ActionListenerImpl.jaiva

- Don't cast to UICommand, instead use ActionSource.

A src/com/sun/faces/application/StateManagerImpl.java

- Break this out since name changes make it impossible to have it be the
  same class.

- add method to tell if we're saving in the client.  Take that method
  away from Util.

M src/com/sun/faces/application/ViewHandlerImpl.java

- name changes.

M src/com/sun/faces/renderkit/ResponseStateManagerImpl.java

- remove the writeStateMarker() functionality.

M src/com/sun/faces/renderkit/html_basic/FormRenderer.java

- Call writeState().  Moved from tag.

M src/com/sun/faces/taglib/html_basic/FormTag.java

- no need for doEndTag().  Moved into Renderer.

M src/com/sun/faces/taglib/jsf_core/ViewTag.java

- lots of logic changes.  see diffs.

M src/com/sun/faces/util/Util.java

- remove boolean convenience method for accessing the state init param.

M test/com/sun/faces/lifecycle/TestSaveStateInPage.java

- Change to accomodate new API.

	renderkit02.jsp renderkit03.jsp 
Log Message:
Craig, Is this ok with you:

According to the spec change in section 2.1.1, we need to call 
facesContext.setViewRoot() passing in the newly created view to handle the 
non-faces-request generates faces response case.

	Util.java 
Log Message:
[r=edburns]

Removing stale generateId method. No longer used and the id's it generates are not valid.

	html_basic.tld 
Log Message:
[r=craigmcc]

Changed the command attribute "label" to "value". Added "converter" attribute to commands. 

Log Message:
M src/com/sun/faces/application/StateManagerImpl.java
  * bugfix: while restoring the tree strucuture, process the children
    if facets.
  * remove the parameter to build and restoreTreeStructure method that
    was used to tell if the root is being processed. It not required
    since the root is processed separately.

M test/com/sun/faces/lifecycle/TestSaveStateInPage.java
  update method signatures to go with the above change,

	TestNavigationHandler.java 
Log Message:
null outcome is now valid.  NavigationHandler should just keep the originating
view identifier.  This test now reflects this.

	HtmlResponseWriter.java 
Log Message:
This change bundle ensures empty elements meet the HTML compatability guidelines
outlined in the XHTML specification - http://www.w3.org/TR/xhtml1/#C_2 

	RenderKitImpl.java 
Log Message:
addRenderer now replaces existing renderer if the rendererType is the same.

	TestRenderKit.java 
Log Message:
changes to reflect the change that allows addRenderer to replace renderers

M build-tests.xml
   - added TestConfigListener
M src/com/sun/faces/jsf-ri-config.xml
   - add new message
M src/com/sun/faces/config/ConfigListener.java
   - clean up exception handling a bit; incorporate
      mechanism to prevent contextInitialized method
      execution more than once for the same webapp;
M src/com/sun/faces/config/ConfigParser.java
   - clean up exception handling a bit;
M src/com/sun/faces/util/Util.java
   - new message id
M test/com/sun/faces/FacesTestCaseService.java
   - manually reset the mechanism to allow
     ConfigLister.contextInitialized execution (for each test);
M test/com/sun/faces/util/TestUtil_messages.java
   - new message id;
A test/com/sun/faces/config/ConfigListenerReset.java
   - utility class used by test framework to manually reset
      machanism to allow ConfigListener.contextInitialized execution
      (for each test);
A test/com/sun/faces/config/TestConfigListener.java
   - manually invokes ConfigListener.contextInitialized method consecutively; 

	ConfigListener.java 
Log Message:
removed local assignment of ClassLoader since it's an instance var;

	ConfigManagedBean.java 
Log Message:
M src/com/sun/faces/config/ConfigManagedBean.java
  - remove unnecessary "throws FacesException"
  - added logging;
  - check for null "property" in addProperty method 

	TestManagedBeanFactory.java 
Log Message:
M test/com/sun/faces/config/TestManagedBeanFactory.java
   - added test for exceptions; 

	ConfigListener.java 
Log Message:
M src/com/sun/faces/config/ConfigListener.java
   - calls Util.getCurrentLoader..
   - removed hack method 

	Util.java 
Log Message:
M src/com/sun/faces/util/Util.java
   - added "getCurrentLoader" method; 

	FacesTestCaseService.java 
Log Message:
R test/com/sun/faces/config/ConfigListenerReset.java
   - hack class no longer needed 
M test/com/sun/faces/FacesTestCaseService.java
   - call configListener.contextDestroyed to remove current
     loader from set; 

	MessageResourcesImpl.java 
Log Message:
M src/com/sun/faces/application/MessageResourcesImpl.java
  - don't perform locale matching when adding a catalog.  Look
    for the specific locale (see findCatalogForSpecificLocale())
  - Minor cleanup

M src/com/sun/faces/config/ConfigParser.java
  - Use findCatalogForSpecificLocale() vs locale matching.
    If a catalog for the specific locale doesn't exist, create
    and return, otherwise return and add the message for that
    locale.

	TestConverters.java 
Log Message:
Removed JDK 1.4.x dependencies.

Known Issues With This Release
==============================

Legal Notice
============

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle, Santa
Clara, California 95054, U.S.A. All rights reserved.

Sun Microsystems, Inc. has intellectual property rights relating to
technology embodied in this product. In particular, and without
limitation, these intellectual property rights may include one or more
of the U.S. patents listed at http://www.sun.com/patents and one or more
additional patents or pending patent applications in the U.S. and other
countries.

This product is distributed under licenses restricting its use, copying
distribution, and decompilation. No part of this product may be
reproduced in any form by any means without prior written authorization
of Sun and its licensors, if any.

Third-party software, including font technology, is copyrighted and
licensed from Sun suppliers.

Sun, Sun Microsystems, the Sun logo, the Java Coffee Cup logo,
JavaServer, and Java are trademarks or registered trademarks of Sun
Microsystems, Inc. in the U.S. and other countries.

Federal Acquisitions: Commercial Software - Government Users Subject to
Standard License Terms and Conditions.

-----------------------------------------------------------------------

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle,
Santa Clara, California 95054, Etats-Unis. Tous droits réservés.

Sun Microsystems, Inc. a les droits de propriété intellectuels relatants
à la technologie incorporée dans ce produit. En particulier, et sans la
limitation, ces droits de propriété intellectuels peuvent inclure un ou
plus des brevets américains énumérés à http://www.sun.com/patents et un
ou les brevets plus supplémentaires ou les applications de brevet en
attente dans les Etats - Unis et les autres pays.

Ce produit ou document est protégé par un copyright et distribué avec
des licences qui en restreignent l'utilisation, la copie, la
distribution, et la décompilation. Aucune partie de ce produit ou
document ne peut être reproduite sous aucune forme, par quelque moyen
que ce soit, sans l'autorisation préalable et écrite de Sun et de ses
bailleurs de licence, s'il y ena.

Le logiciel détenu par des tiers, et qui comprend la technologie
relative aux polices de caractères, est protégé par un copyright et
licencié par des fournisseurs de Sun.

Sun, Sun Microsystems, le logo Sun, le logo Java Coffee Cup, JavaServer,
et Java sont des marques de fabrique ou des marques déposées de Sun
Microsystems, Inc. aux Etats-Unis et dans d'autres pays.
