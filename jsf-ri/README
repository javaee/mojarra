This README documents the Sun Reference implementation (RI) for JSR 127,
JavaServer (tm) Faces.

jsf-api cvs tag for this implementation: JSF_API_20031017
jsf-api-spec for this implementation: <>

Installation Notes
==================

JavaServer (tm) Faces is intended to run in a Servlet 2.3, JSP 1.2 web
container, such as that distributed with Java Web Services Developer
Pack <http://java.sun.com/webservices/webservicespack.html>.  Please
follow the instructions for your container and have it working well in
your environment before continuing with these installation notes.

To use JavaServer (tm) Faces in your own webapp, you need to follow the
online documentation at <http://java.sun.com/j2ee/javaserverfaces/>.
Make sure to include all the jars in the lib directory of this
distribution in your WEB-INF/lib directory in your webapp.  

Major changes/features in this release:
=======================================

SECTION: API Changes by scarab issue, since JSF_API_20030930 draft (103
         commit messages)

[JSFA101] 

  build changes for code gen

  For those HTML attributes that are "numberish" such as "height", make
  the type "java.lang.String".

"[NEW] ValueHolder and "valid""  

  Add ConvertableValueHolder (extends ValueHolder) interface.  Migrate
  "converter" property from ValueHolder to ConvertableValueHolder.  Add
  "valid" property, to be removed from UIInput.

  Add ConvertableValueHolderSupport (extends ValueHolderSupport) for
  delegation support.

  NOTE:  unit tests do not currently run; all our recent changes have left
  them in need of some refactoring.  I'm going to do that next.

  RI IMPACT:  Any code that casts to ValueHolder in order to access the
  "converter" property must cast to "ConvertableValueHolder" instead.  Any
  code that casts to UIInput to access the "valid" property must cast to
  "ConvertableValueHolder" instead.

  Correct implementation of delegated state restoration to
  ValueHolderSupport, and correct saving/restoring of Converter as an
  attached object.

  add "supported-component-class" element to dtd.

  M doc/standard-html-renderkit.xml
    * added usemap and ismap attributes to Image.
    * added shape, coords, rel, rev, hreflang attributes to hyperlink.

[JSFA3]

  Update Javadocs for UIComponent.setId() to remove the restriction that
  component ids cannot start with UIViewRoot.UNIQUE_ID_PREFIX (otherwise,
  component tags would not be able to generate such ids).  The corresponding
  code change in UIComponentBase was checked in on 10/07/2003.

test changes

  * Avoid the need for laborious cut-n-paste code in testStateHolder
    by factoring out the stuff that changes.

  * More importantly, ensure that a component subclass saves and restores
    all the state for its superclass as well as itself.

[JSFA80][JSFA108]

  M src/javax/faces/application/ViewHandler.java

    added calculateLocale() method.

  M src/javax/faces/application/MessageResources.java

  Reflect location change of Locale

  r=visvan

  Make it so the overrideProperties for the tag that handles UIViewRoot is
  called.

  Provide for the <f:view> tag to have a "locale" attribute.

  RI Impact: Handled atomically in this checkin.

  r=edburns

  SECTION: API Changes

  M doc/standard-html-renderkit.xml

  - add property for "locale".

  M src/javax/faces/webapp/UIComponentTag.java

  - Make it so the tag handler for UIViewRoot tag gets its
    overrideProperties() method called once per pageContext instance.
    This replicates the behaviour for non-root tags.

  SECTION: RI Changes

  A test/com/sun/faces/taglib/jsf_core/TestViewTag.java
  A web/test/TestViewTag.jsp

  - exercise standard behavior of this feature

  M build-tests.xml

  - add TestViewTag.

  M conf/share/jsf_core.tld

  - add the "locale" attribute

  M src/com/sun/faces/taglib/jsf_core/ViewTag.java

  - add the "locale" attribute, make it elexpression enabled.

  - add override properties to set the locale into the ViewRoot if set.

  M systest/web/message01.jsp
  M systest/web/message02.jsp
  M systest/web/message03.jsp

  - make these run.


  r=craigmcc
  Author: visvan

  M src/javax/faces/component/UIViewRoot.java
    added methods setLocale() and getLocale().

  M src/javax/faces/context/FacesContext.java
    remove methods setLocale() and getLocale().

  M src/javax/faces/convert/DateTimeConverter.java
  M src/javax/faces/convert/NumberConverter.java
    set and get locale from UIViewRoot instead of FacesContext.


  Spec that any errors during startup or parsing of the config file must
  cause the FacesServlet.init() method to throw ServletException,
  causing the servlet to not be placed into service.

  RI IMPACT: 

  Make sure that errors in the config file cause FacesServlet.init() to
  throw ServletException.  Have some unit tests that prove this is the
  case.

  r=visvan

  Implement 1 and 2 from
  <http://archives.java.sun.com/cgi-bin/wa?A2=ind0310&L=jsr-127-eg&F=&S=&X=04C77A2F703823CF44&Y=ed.burns@sun.com&P=21467>

  SECTION: API Changes

  M doc/web-facesconfig_1_0.dtd

  - add the "locale-config" element to "application".

  - define the contents of the locale-config element.

  M src/javax/faces/application/Application.java

  - APIs for locale on Application

  M test/javax/faces/mock/MockApplication.java

  - make it compile

  SECTION: RI Changes.

  A web/test/locale-config.xml
  A web/test/locale-config1.xml
  A web/test/locale-config2.xml

  - test config files

  M src/com/sun/faces/application/ApplicationImpl.java

  - impl of new methods for Locale.

  M src/com/sun/faces/config/ConfigApplication.java

  - things called by Digester code.

  M src/com/sun/faces/config/ConfigParser.java

  - rules to store the result into the Application instance.

  - rules to set the bean from the config file.

  - move private Locale getLocale() to public static Locale
    Util.getLocaleFromString()

  M src/com/sun/faces/util/Util.java

  - new method: 

  public static Locale Util.getLocaleFromString()

  M test/com/sun/faces/application/TestApplicationImpl_Config.java

  - exercise core and edge cases for Locale from config file.

  M test/com/sun/faces/util/TestUtil_local.java

  - exercise core and edge cases for Locale from string



[JSFA128]

  M doc/web-facesconfig_1_0.dtd

  - replace "values" element within "managed-property" element to be
    "list-entries" per EG request.

  M test/javax/faces/webapp/config-file-1.xml

  - make the test file conform to the DTD changes

  SECTION: RI Changes

  M src/com/sun/faces/config/ConfigParser.java

  - change "values" to "list-entries"

  M src/com/sun/faces/config/ManagedBeanFactory.java

  - fix broken implementation of List and Map config from a faces-config
    file.

    New methods: 

	      arrayOrList = getArrayOrListToSetIntoBean(bean, cmp);

		      map = getMapToSetIntoBean(bean, cmp);

  M test/com/sun/faces/TestBean.java

  - This thing wasn't really a bean.  Fixed bean convention violations
    that were exposed when the core impl was fixed.

  M test/com/sun/faces/config/ConfigFileTestCase.java

  - added testcase:

  +    public void testMapPositive() throws Exception {

  M test/com/sun/faces/config/NewCustomerFormHandler.java

  - Added "array of Strings" property

  M test/com/sun/faces/config/TestManagedBeanFactory.java

  - adjust testcase to take non-broken impl into account

  M web/test/WEB-INF/faces-config.xml

  - make the test file conform to the DTD changes

  r=visvan

  The second and final part of the RI changes for this issue.

  Make it allowable for List and Map instances to me created and populated
  into the scoped namespace from the config file.

  SECTION: API Changes

  M doc/web-facesconfig_1_0.dtd

  SECTION: RI Changes

  A web/test/WEB-INF/config-lists-and-maps.xml
  M src/com/sun/faces/config/ConfigManagedBean.java

  - tweak this so it handles the case where you have a managed bean that
    *is* a List or Map, rather than having a List or Map.

  M src/com/sun/faces/config/ConfigParser.java

  - ugliness.  Rule tweakings to allow the above change.

  M src/com/sun/faces/config/ManagedBeanFactory.java

  - refactoring.  Create new methods:

  +		    copyListEntriesFromConfigToList(cmp, (List) bean);
  +		copyMapEntriesFromConfigToMap(cmp, (Map) bean);

  M test/com/sun/faces/config/ConfigFileTestCase.java

  - Test with some wackiness.

[TCK] 

  Updated createConverter exceptions for the case where the converter
  cannot be created.  Corrected typo on one NullPointerException

[JSFA29]

  Default the row index to 0 (i.e. the first row) instead of -1 (i.e. before
  the first row) so that the 'rowData' property of a DataModel works
  intuitively in a value reference expression without having to be specifically
  tweaked.

  Missed some one-relative --> zero-relative changes.

  Correct javadoc description of when the exception is thrown.

  More (hopefully last) bugfixes for 1-relative to 0-relative row indexes.

  Add getters for the wrapped data; beanify ScalarDataModel as well as
  the rest of them.

  Call ResultSet.updateRow() if any column in the underlying row has
  been updated.  Only call ResultSet.updateObject() if the value
  actually changed.

  Revise Map implementation returned by getRowData() to properly
  delegate get and put operations to the correct row on the underlying
  ResultSet.

  Enhance tests on DataModel implications to ensure that updates through
  the object returned by rowData flow through to the underlying data.

  Make all the DataModel implementations into pure JavaBeans (zero args
  constructor, setter method for the wrapped data) for improved ability
  to assemble them.

  Leverage the ResultSet.last() method to avoid having to explicitly
  scroll through all the rows to count them.  (This is still likely to
  get refined into supporting an "I don't know" answer, but this is
  better than scrolling.)

  Move ArrayDataModel and ListDataModel implementations from
  j.f.component to j.f.model, and make them public.  Add new
  implementations for wrapping result sets and individual JavaBeans.

  UIData: synthesize a ResultSetDataModel around a ResultSet value, or a
  ScalarDataModel around any individual JavaBean.

  Add test cases for javax.faces.model implementations.

  Migrate tests for javax.faces.model and javax.faces.webapp to use the
  <junit> target to execute all of the *TestCase.java classes in the
  corresponding package.

  Add a default DataModel implementation that wraps
  javax.servlet.jsp.jstl.Result (i.e. the results of an SQL query done
  by JSTL tags), and associated unit tests.

  RI Impact: None, because the getRowData() object will return a Map,
  which is already supported by the default PropertyResolver
  implementation.

  First of several refinements to UIData and DataModel, based on EG feedback:
  * Remove erase() method from UIData and RepeaterSupport.
  * Remove open() and close() methods from DataModel and implementations,
    along with the related event listener methods on DataModelListener.
  * Make DataModel an abstract base class with concrete implementations of
    the listener registration methods.

  RI IMPACT:  TableRenderer may need to be revised to avoid calling open(),
  or worrying about IllegalStateException.

  DEMO IMPACT:  Ensure that the UIData example still works.

  Make row index values zero-relative instead of one-relative.

  RI IMPACT:  Make sure TableRenderer is adjusted for this.

  DEMO IMPACT:  Make sure UIData sample is adjusted for this.

  Make ResultSetDataModel.getRowData() return a Map of column name->value
  entries, eliminating the need to customize the default PropertyResolver.

  RI IMPACT:  Disregard the previous requirement to customze the default
  PopertyResolverImplementation.

  DEMO IMPACT:  None.


  RI IMPACT:
  =========

  The default PropertyResolver will need to be extended to support the
  following additional functionality when the "base" object is of type
  javax.faces.model.ResultSetDataModel:

  * getValue(Object,String) - call value(String) on the base object
  * getValue(Object,int) - call value(int) on the base object
  * setValue(Object,String,Object) - call value(String,Object) on the base object
  * setValue(Object,int,Object) - call value(int,Object) on the base object
  * isReadOnly(Object,String) - call readOnly(String)
  * isReadOnly(Object,int) - call readOnly(int)
  * getType(Object,String) - call type(String)
  * getType(Object,int) - call type(int)

  PENDING(craigmcc) - the readOnly() and type() methods need to be added
  to ResultSetDataModel; see next checkin.

  ResultSetDataModel:  Implement the readOnly() and type() methods needed
  for robust support of PropertyResolver.

  RI IMPACT:  See previous ResultSetDataModel commit message.

  PENDING:  Unit tests for the (now public) DataMode wrapper implementations.


SECTION: Spec document changes:

[JSFA29]

3.1:      Update "User Interface Component Model" to reflect recent changes to
          fundamental UIComponent APIs (clean-up).

3.2.2:    Describe new ConvertableValueHolder interface.

3.2.6:    Update description of ValueHolder to remove "converter" property.

4.1.3:    Update description of default DataModel wrapper implementations
          to include support for java.sql.ResultSet,
          javax.servlet.jsp.jstl.sql.Result, and JavaBeans (wrapped in a
          one-row "model").  Document the convenience wrapper implementations
          provided in the "javax.faces.model" package.

4.1.7:    Note that UIOutput now implements ConvertableValueHolder (and,
          therefore, do all its subclasses), not ValueHolder.

5.1.2:    Update semantics of property resolution so that "." and "[]"
          will work when value-a is a javax.faces.model.ResultSetDataModel
          instance (which is what ResultSetDataModel returns for the
          getRowData() method).

  Spec updates to reflect the UIData, DataModel, and Repeater changes just
  checked in to jsf-api.  Refer to those commit messages for RI/DEMO IMPACT.

RI IMPACT:  Already described in corresponding "jsf-api" commits.

[JSFA128]

  5.2.1.2

    new rules for managed bean properties that are Maps, Lists, or arrays.

    Allow Lists or Map to *be* managed beans.

  RI IMPACT: Change implementation to allow Lists and Maps to *be* managed
  beans.

[JSFA101]

8.5

  Default values for renderer-dependent attributes.

[JSFA180][JSFA106]

7.1.8

  Define methods in Application for Locale support.

[JSFA180][JSFA106]

9.3

  <f:view/> tag

    State what to do with the "locale" attribute on this tag.

    Assert that the javax.servlet.jsp.jstl.core.Config.set() method must
    be called with the appropriate parameters.





SECTION: RI Changes: 150 commit messages

Known Issues With This Release
==============================

* cardemo checkboxes do not properly set themselves when choosing a
  package.

* cardemo dynamic pricing is broken, the prices always go up!

* Some renderer (and therefore tag) attributes have the incorrect type
  with respect to the HTML 4.01 spec.

Legal Notice
============

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle, Santa
Clara, California 95054, U.S.A. All rights reserved.

Sun Microsystems, Inc. has intellectual property rights relating to
technology embodied in this product. In particular, and without
limitation, these intellectual property rights may include one or more
of the U.S. patents listed at http://www.sun.com/patents and one or more
additional patents or pending patent applications in the U.S. and other
countries.

This product is distributed under licenses restricting its use, copying
distribution, and decompilation. No part of this product may be
reproduced in any form by any means without prior written authorization
of Sun and its licensors, if any.

Third-party software, including font technology, is copyrighted and
licensed from Sun suppliers.

Sun, Sun Microsystems, the Sun logo, the Java Coffee Cup logo,
JavaServer, and Java are trademarks or registered trademarks of Sun
Microsystems, Inc. in the U.S. and other countries.

Federal Acquisitions: Commercial Software - Government Users Subject to
Standard License Terms and Conditions.

-----------------------------------------------------------------------

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle,
Santa Clara, California 95054, Etats-Unis. Tous droits réservés.

Sun Microsystems, Inc. a les droits de propriété intellectuels relatants
à la technologie incorporée dans ce produit. En particulier, et sans la
limitation, ces droits de propriété intellectuels peuvent inclure un ou
plus des brevets américains énumérés à http://www.sun.com/patents et un
ou les brevets plus supplémentaires ou les applications de brevet en
attente dans les Etats - Unis et les autres pays.

Ce produit ou document est protégé par un copyright et distribué avec
des licences qui en restreignent l'utilisation, la copie, la
distribution, et la décompilation. Aucune partie de ce produit ou
document ne peut être reproduite sous aucune forme, par quelque moyen
que ce soit, sans l'autorisation préalable et écrite de Sun et de ses
bailleurs de licence, s'il y ena.

Le logiciel détenu par des tiers, et qui comprend la technologie
relative aux polices de caractères, est protégé par un copyright et
licencié par des fournisseurs de Sun.

Sun, Sun Microsystems, le logo Sun, le logo Java Coffee Cup, JavaServer,
et Java sont des marques de fabrique ou des marques déposées de Sun
Microsystems, Inc. aux Etats-Unis et dans d'autres pays.
