This README documents the Sun Reference implementation (RI) for JSR 127,
JavaServer (tm) Faces.

jsf-api cvs tag for this implementation: JSF_API_20031023
jsf-api-spec for this implementation: <JSF_20031023.pdf>

Installation Notes
==================

JavaServer (tm) Faces is intended to run in a Servlet 2.3, JSP 1.2 web
container, such as that distributed with Java Web Services Developer
Pack <http://java.sun.com/webservices/webservicespack.html>.  Please
follow the instructions for your container and have it working well in
your environment before continuing with these installation notes.

To use JavaServer (tm) Faces in your own webapp, you need to follow the
online documentation at <http://java.sun.com/j2ee/javaserverfaces/>.
Make sure to include all the jars in the lib directory of this
distribution in your WEB-INF/lib directory in your webapp.  

Major changes/features in this release:
=======================================

SECTION: API Changes

Scarab Issue:  [JSFA29] (indirectly)

M src/javax/faces/context/FacesContext.java

- Change the way messages are looked up from being keyed by UIComponent
  to being keyed by client identifier, so we can eliminate the knowledge
  of Repeater that is currently necessary.

- Correct the description of the IllegalStateException cases to describe
  the actual condition we wish to test (and what the RI already does).

- These changes are orthogonal to changes related to how Message instances
  are created, and the existence of MessageResources.

M src/javax/faces/component/UIInput.java
M src/javax/faces/component/UISelectMany.java
M src/javax/faces/component/UISelectOne.java

- Adapt to new method signature for FacesContext.addMessage().

M src/javax/faces/validator/DoubleRangeValidator.java
M src/javax/faces/validator/LengthValidator.java
M src/javax/faces/validator/LongRangeValidator.java
M src/javax/faces/validator/StringRangeValidator.java

- Adapt to new method signature for FacesContext.addMessage().

M test/javax/faces/component/UISelectManyTestCase.java
M test/javax/faces/component/UISelectOneTestCase.java

- Explicitly set rendererType to null since we are now triggering
  getClientId() calls when enqueuing messages.

M test/javax/faces/mock/MockFacesContext.java

- Adjust implementation to new message registration requirements.


RI IMPACTS:

- Adjust message queueing and lookup as needed.

- FacesContextImpl does not really need to keep two message data
  structures, since null is a legal key in a Map.

- Ensure that ErrorsRenderer still finds the correct messages,
  both within a Repeater and outside a Repeater.

M src/javax/faces/model/DataModel.java

- Make setWrappedData() public, and add pubic getWrappedData().
- Formally allow a DataModel instance to be detached from the data
  it is wrapping, by calling setWrappedData(null).
- Add IllegalStateException errors when trying to call most methods
  when we're detached.

M src/javax/faces/model/ArrayDataModel.java
M src/javax/faces/model/ListDataModel.java
M src/javax/faces/model/ResultDataModel.java
M src/javax/faces/model/ScalarDataModel.java

- Changes required to meet the updated DataModel contracts.

M src/javax/faces/model/ResultSetDataModel.java

- Changes required to meet the updated DataModel contracts.
- Defer the call get getMetaData() because it probably won't work
  at design time
- Eliminate the check for a scrollable cursor at setWrappedData()
  time -- this will manifest itself as a FacesException later.

M test/javax/faces/model/DataModelTestCaseBase.java

- Refine tests for the new DataModel contracts.


RI IMPACT:  None.


DEMO IMPACT:  Ensure that the UIData and DataModel screens in "standard"
still work once the RI is updated for the next snapshot.

Beginnings of remodel for state saving and restoring in Repeater components
(i.e. UIData).  The end objective is to allow child components to implement
their ValueHolder et. al. properties normally, without having to be aware
that they are inside a Repeater.

All of the unit tests currently work, but UIData is not currently capable
of saving and restoring the per-row state of its children in a complete
manner.  I wanted to localize the impact of my remaining changes to avoid
conflicts with other checkins on the HEAD of jsf-api.

PENDING:  these changes make the value of having ValueHolderSupport and
ConvertableValueHolderSupport minimal again, so I will probably remove them
if nothing else shows up to motivate their retention.

PENDING:  Unit tests for UIData that exercise the per-row state saving
and restoring capabilities.

PENDING:  Factor the per-row stuff out into a new-style RepeaterSupport
if and only if it makes sense.


[JSFA80][JSFA106]

Per EG agreement, remove StringRangeValidator.

RI IMPACT:  Remove corresponding tag from TLD and jsf_core library.

M src/javax/faces/component/UIComponent.java

- remove the IOException from the javadoc for
  process{Save,Restore}State().

M src/javax/faces/convert/DateTimeConverter.java

- Make the DEFAULT_TIME_ZONE be GMT.

M src/javax/faces/validator/DoubleRangeValidator.java

- Make get{Minimum,Maximum}() return Double.MIN_VALUE,DOUBLE.MAX_VALUE
  respectively

M test/javax/faces/component/UIInputTestCase.java

- remove import of StringRangeValidator

M src/javax/faces/convert/Converter.java

- assert that converters must obtain their Locale from the UIViewRoot,
  unless they have a special need for maintaining their own, settable,
  Locale.

M src/javax/faces/convert/NumberConverter.java

- State that this converter gets its Locale from the UIViewRoot

RI IMPACT: 

define new FACES_API_MESSAGE javax.faces.validator.NOT_IN_RANGE.

This must say something like: The value is not in the expected range of
{0} to {1}.

M src/javax/faces/validator/DoubleRangeValidator.java

- Use the new NOT_IN_RANGE_ID if the value 

M src/javax/faces/validator/ValidatorMessages.java

- define constant for NOT_IN_RANGE_ID

M src/javax/faces/component/UIViewRoot.java
M test/javax/faces/component/UIViewRootTestCase.java
  save locale as part of state information.

[JSFA101]

	standard-html-renderkit.xml 
Log Message:
remove "formName" attribute


[JSFA3]

Hans found two bugs.  1. On postback with a redisplay of the same view,
the UIViewRoot needs to generate the same ids as it did the first time
around.  This is accomplished by setting the viewRoot's lastId counter
to zero on processDecodes.  2. id uniqueness checking should be done on
clientIds, not component ids.

SUBSECTION: API Changes

M src/javax/faces/component/UIViewRoot.java

- set the lastId to zero in processDecodes.  This is necessary because
  it doesn't get cleared in the save state in server case, and it needs
  to.

M src/javax/faces/webapp/UIComponentTag.java

- doStartTag(): move the component id uniqueness checking to after
  findComponent().  This enables us to use the clientId for uniqueness
  checking.  Only do the check if the author has manually assigned an id.

- findComponent(): more special case code in the UIViewRoot case.  see
  comments.

M test/javax/faces/webapp/UIComponentTagTestCase.java

- take above changes into account.

SUBSECTION: RI Changes

M src/com/sun/faces/application/StateManagerImpl.java

- call getClientId() instead of getId() for uniqueness checking.

- pass the FacesContext into all methods that now call getClientId().

M systest/build-tests.xml

- allow the debugging of HtmlUnit systests with JPDA.

M test/com/sun/faces/application/TestStateManagerImpl.java

- create the tree fresh each time.

M systest/src/com/sun/faces/htmlunit/AbstractTestCase.java

+    protected boolean clearAllCookies() {

M systest/src/com/sun/faces/jsptest/JspIntegrationTestCase.java

- un-comment code in one of the test methods.

M test/com/sun/faces/application/TestStateManagerImpl.java

- make sure the tree is built fresh each time through a test.

M test/com/sun/faces/lifecycle/TestSaveStateInPage.java

- pass the FacesContext into all methods that now call getClientId().



SECTION: Spec Document Changes

Scarab Issue:  [JSFA29]

3.1:      Update "User Interface Component Model" to reflect recent changes to
          fundamental UIComponent APIs (clean-up).

3.2.2:    Describe new ConvertableValueHolder interface.

3.2.6:    Update description of ValueHolder to remove "converter" property.

4.1.3:    Update description of default DataModel wrapper implementations
          to include support for java.sql.ResultSet,
          javax.servlet.jsp.jstl.sql.Result, and JavaBeans (wrapped in a
          one-row "model").  Document the convenience wrapper implementations
          provided in the "javax.faces.model" package.

4.1.7:    Note that UIOutput now implements ConvertableValueHolder (and,
          therefore, do all its subclasses), not ValueHolder.

5.1.2:    Update semantics of property resolution so that "." and "[]"
          will work when value-a is a javax.faces.model.ResultSetDataModel
          instance (which is what ResultSetDataModel returns for the
          getRowData() method).

Spec updates to reflect the UIData, DataModel, and Repeater changes just
checked in to jsf-api.  Refer to those commit messages for RI/DEMO IMPACT.

[JSFA128]

5.2.1.2

  new rules for managed bean properties that are Maps, Lists, or arrays.

  Allow Lists or Map to *be* managed beans.

RI IMPACT: Change implementation to allow Lists and Maps to *be* managed
beans.

[JSFA101]

8.5

  Default values for renderer-dependent attributes.

[JSFA180][JSFA106]

7.1.8

  Define methods in Application for Locale support.

[JSFA180][JSFA106]

9.3

  <f:view/> tag

    State what to do with the "locale" attribute on this tag.

[JSFA180][JSFA106]

9.3

  <f:view/> tag

    Assert that the javax.servlet.jsp.jstl.core.Config.set() method must
    be called with the appropriate parameters.

The creation of the UIData component and Table renderer has made the "Data"
and "List" renderers for UIPanel obsolete, so remove them from the spec.

API IMPACT:  None.

RI IMPACT:
* Remove corresponding Renderers
* Remove corresponding Unit Tests

DEMO IMPACT:
* Remodel any demos using these renderers to use <h:data_table> instead.

Update the spec to reflect the just-checked-in API changes:
* FacesContext attaches messages to client identifiers, not components.
* Remove StringRangeValidator.

RI IMPACTS:  See the API checkin message.

DEMO IMPACTS:  See the API checkin message.


Known Issues With This Release
==============================

* cardemo checkboxes do not properly set themselves when choosing a
  package.

* cardemo dynamic pricing is broken, the prices always go up!

* Some renderer (and therefore tag) attributes have the incorrect type
  with respect to the HTML 4.01 spec.

Legal Notice
============

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle, Santa
Clara, California 95054, U.S.A. All rights reserved.

Sun Microsystems, Inc. has intellectual property rights relating to
technology embodied in this product. In particular, and without
limitation, these intellectual property rights may include one or more
of the U.S. patents listed at http://www.sun.com/patents and one or more
additional patents or pending patent applications in the U.S. and other
countries.

This product is distributed under licenses restricting its use, copying
distribution, and decompilation. No part of this product may be
reproduced in any form by any means without prior written authorization
of Sun and its licensors, if any.

Third-party software, including font technology, is copyrighted and
licensed from Sun suppliers.

Sun, Sun Microsystems, the Sun logo, the Java Coffee Cup logo,
JavaServer, and Java are trademarks or registered trademarks of Sun
Microsystems, Inc. in the U.S. and other countries.

Federal Acquisitions: Commercial Software - Government Users Subject to
Standard License Terms and Conditions.

-----------------------------------------------------------------------

Copyright © 2002 Sun Microsystems, Inc., 4150 Network Circle,
Santa Clara, California 95054, Etats-Unis. Tous droits réservés.

Sun Microsystems, Inc. a les droits de propriété intellectuels relatants
à la technologie incorporée dans ce produit. En particulier, et sans la
limitation, ces droits de propriété intellectuels peuvent inclure un ou
plus des brevets américains énumérés à http://www.sun.com/patents et un
ou les brevets plus supplémentaires ou les applications de brevet en
attente dans les Etats - Unis et les autres pays.

Ce produit ou document est protégé par un copyright et distribué avec
des licences qui en restreignent l'utilisation, la copie, la
distribution, et la décompilation. Aucune partie de ce produit ou
document ne peut être reproduite sous aucune forme, par quelque moyen
que ce soit, sans l'autorisation préalable et écrite de Sun et de ses
bailleurs de licence, s'il y ena.

Le logiciel détenu par des tiers, et qui comprend la technologie
relative aux polices de caractères, est protégé par un copyright et
licencié par des fournisseurs de Sun.

Sun, Sun Microsystems, le logo Sun, le logo Java Coffee Cup, JavaServer,
et Java sont des marques de fabrique ou des marques déposées de Sun
Microsystems, Inc. aux Etats-Unis et dans d'autres pays.
